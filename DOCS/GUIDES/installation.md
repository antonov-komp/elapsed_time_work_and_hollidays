# Руководство по установке приложения

**Дата создания:** 2025-12-12 10:46 (UTC+3, Брест)  
**Версия:** 1.0  
**Описание:** Пошаговое руководство по установке приложения-встройки Bitrix24 "Мой Ежемесячный табель присутствия"

---

## Требования

### Серверные требования
- PHP 8.3+ с расширением `curl`
- Права на запись в папку `logs/` (775)
- Права на запись файла `settings.json` (664)
- HTTPS (рекомендуется для production)

### Bitrix24 требования
- Облачная версия Bitrix24 или коробочная версия
- Права администратора для установки локальных приложений
- OAuth Application ID и Secret

---

## Шаг 1: Подготовка приложения в Bitrix24

### 1.1. Создание OAuth приложения

1. Войдите в Bitrix24 как администратор
2. Перейдите в **Настройки** → **Разработчикам** → **Другие** → **Добавить приложение**
3. Заполните форму:
   - **Название:** Мой Ежемесячный табель присутствия
   - **Красный URL:** `https://ваш-домен.ru/install.php`
   - **Права доступа:** Выберите необходимые права (например, `user`, `placement`)
4. Сохраните приложение
5. Скопируйте **Application ID** и **Application Secret**

### 1.2. Настройка placement

Placement `USER_PROFILE_TOOLBAR` будет зарегистрирован автоматически при установке.

---

## Шаг 2: Настройка сервера

### 2.1. Загрузка файлов

Загрузите все файлы приложения на сервер:
```
back1/
├── install.php
├── placement.php
├── index.php
├── crest.php
├── settings.php
├── checkserver.php
├── css/
└── DOCS/
```

### 2.2. Настройка settings.php

Откройте файл `settings.php` и укажите ваши данные:

```php
<?php
define('C_REST_CLIENT_ID','ваш-application-id'); // Application ID
define('C_REST_CLIENT_SECRET','ваш-application-secret'); // Application Secret
```

**⚠️ ВАЖНО:** Не коммитьте `settings.php` в репозиторий! Файл должен быть в `.gitignore`.

### 2.3. Настройка прав доступа

Установите права доступа:
```bash
chmod 775 logs/
chmod 664 settings.json (если файл существует)
```

### 2.4. Проверка сервера

Откройте в браузере: `https://ваш-домен.ru/checkserver.php`

Должно отобразиться:
```
Array
(
    [success] => Success!
)
```

Если есть ошибки, исправьте их согласно сообщениям.

---

## Шаг 3: Установка приложения в Bitrix24

### 3.1. Установка через OAuth

1. Откройте в браузере: `https://ваш-домен.ru/install.php`
2. Bitrix24 перенаправит на страницу авторизации
3. Разрешите доступ приложению
4. После успешной установки вы увидите сообщение: "installation has been finished"

### 3.2. Проверка установки

1. Перейдите в профиль пользователя в Bitrix24
2. В панели инструментов должен появиться пункт: **"Мой Ежемесячный табель присутствия"**
3. Кликните на него — должна открыться страница `placement.php`

### 3.3. Проверка мобильного приложения

1. Откройте мобильное приложение Bitrix24
2. В меню должен быть доступен пункт приложения
3. Проверьте работу приложения

---

## Шаг 4: Проверка работы

### 4.1. Проверка placement

1. Откройте профиль пользователя в Bitrix24
2. Найдите пункт **"Мой Ежемесячный табель присутствия"**
3. Кликните на него
4. Должна открыться страница с данными пользователя

### 4.2. Проверка логов

Проверьте папку `logs/` — должны создаваться файлы логов:
```
logs/YYYY-MM-DD/HH/timestamp_type_log.json
```

### 4.3. Проверка токенов

Проверьте файл `settings.json` — должны быть сохранены токены доступа:
```json
{
  "access_token": "...",
  "refresh_token": "...",
  "domain": "ваш-домен.bitrix24.ru",
  "client_endpoint": "https://ваш-домен.bitrix24.ru/rest/",
  ...
}
```

---

## Устранение неполадок

### Ошибка: "error install app"

**Причина:** Неверные Application ID или Application Secret

**Решение:**
1. Проверьте правильность данных в `settings.php`
2. Убедитесь, что Application ID и Secret скопированы без пробелов
3. Проверьте, что приложение создано в Bitrix24

### Ошибка: "Check permission!"

**Причина:** Недостаточно прав на запись файлов

**Решение:**
```bash
chmod 775 logs/
chmod 664 settings.json
```

### Ошибка: "Need install curl lib"

**Причина:** Не установлено расширение curl для PHP

**Решение:**
```bash
# Ubuntu/Debian
sudo apt-get install php-curl

# CentOS/RHEL
sudo yum install php-curl
```

### Placement не отображается

**Причина:** Placement не зарегистрирован

**Решение:**
1. Проверьте логи в `logs/` — должны быть записи об установке
2. Проверьте, что `placement.php` доступен по HTTPS
3. Переустановите приложение через `install.php`

---

## Обновление приложения

### Обновление кода

1. Загрузите новые файлы на сервер
2. Проверьте, что `settings.php` не перезаписан
3. Проверьте работу приложения

### Обновление placement

Placement обновляется автоматически при установке через `install.php`.

---

## Удаление приложения

### Удаление из Bitrix24

1. Перейдите в **Настройки** → **Разработчикам** → **Другие**
2. Найдите ваше приложение
3. Удалите его

### Удаление с сервера

1. Удалите все файлы приложения
2. Очистите папку `logs/` (если нужно)

---

## История изменений

- **2025-12-12 10:46 (UTC+3, Брест):** Создан документ с руководством по установке

