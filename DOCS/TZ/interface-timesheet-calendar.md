# Техническое задание: Интерфейс табеля присутствия (Календарный месяц)

**Дата создания:** 2025-12-12 10:51 (UTC+3, Брест)  
**Дата обновления:** 2025-12-12 10:58 (UTC+3, Брест)  
**Версия:** 1.1 (Дополнено деталями)  
**Статус:** Черновик  
**Описание:** Детальное техническое задание на интерфейс табеля присутствия с календарным отображением месяца  
**Регион:** Республика Беларусь (РБ)

---

## Общая информация

### Название задачи
**Интерфейс табеля присутствия (Календарный месяц)**

### Цель
Создание интерфейса для заполнения табеля присутствия сотрудниками с отображением календарного месяца в виде шахматной доски (все дни месяца).

---

## Описание интерфейса

### 1. Структура интерфейса

#### 1.1. Блок авторизации и информации о пользователе

**Расположение:** Верхняя часть интерфейса

**Содержимое:**
- **ФИО** — полное имя сотрудника
- **Должность** — должность сотрудника

**Источник данных:** Bitrix24 REST API (`user.current`)

**Визуальное оформление:**
- Отображается первой строкой
- Чёткое визуальное выделение
- Формат: "Иванов Иван Иванович | Менеджер по продажам"
- Шрифт: жирный, размер 16-18px
- Цвет текста: тёмно-серый/чёрный
- Фон: светло-серый/белый с лёгкой тенью (опционально)
- Отступы: padding 10-15px

**Обработка данных:**
- Если ФИО отсутствует, отображается только ID пользователя
- Если должность отсутствует, отображается только ФИО
- Если оба поля отсутствуют, отображается "Пользователь #ID"

---

#### 1.2. Блок выбора периода

**Расположение:** Под блоком авторизации

**Элементы:**
- **Выбор месяца:** Выпадающий список с прокруткой
  - Значения: Январь, Февраль, Март, Апрель, Май, Июнь, Июль, Август, Сентябрь, Октябрь, Ноябрь, Декабрь
  - По умолчанию: текущий месяц
  - Ширина: 150-200px
  - Высота списка: максимум 300px с прокруткой

- **Выбор года:** Выпадающий список с прокруткой
  - Диапазон: 2025-2035 (10 лет вперёд)
  - По умолчанию: текущий год
  - Ширина: 100-120px
  - Высота списка: максимум 300px с прокруткой

**Поведение:**
- При изменении месяца/года обновляется календарь
- Сохраняется выбранный период в состоянии приложения
- При смене периода показывается индикатор загрузки (если данные загружаются с сервера)
- Кэширование данных: данные загруженного месяца сохраняются в памяти для быстрого переключения

**Валидация:**
- Нельзя выбрать будущий месяц/год (если текущая дата ещё не наступила)
- Минимальная дата: 2025-01-01
- Максимальная дата: 2035-12-31

---

#### 1.3. Блок статистики

**Расположение:** Под блоком выбора периода

**Содержимое (одна строка, разделённая):**
1. **Сумма часов всего** — общее количество отработанных часов за выбранный месяц
2. **Сумма дней календарных рабочих** — количество дней, где есть хотя бы один рабочий час (факт работы)
3. **Сумма неполных дней** — количество дней, где менее 8 часов
4. **Сумма дней со статусами** — количество дней с особыми статусами (Отпуск, Больничный, Командировка, Отпуск за свой счёт)

**Формат отображения:**
```
Сумма часов: 160 | Рабочих дней: 20 | Неполных дней: 2 | Дней со статусами: 3
```

**Детали расчёта:**
- **Сумма часов всего:** Суммируются все значения `hours` из всех дней месяца (включая неполные дни)
- **Сумма дней календарных рабочих:** Количество дней, где `hours > 0` (независимо от количества часов)
- **Сумма неполных дней:** Количество дней, где `0 < hours < 8` (частичная отработка)
- **Сумма дней со статусами:** Количество дней, где `status !== null` (любой статус)

**Обновление:** Статистика обновляется автоматически при изменении данных (реактивно, без перезагрузки страницы)

**Визуальное оформление:**
- Фон: светло-серый/белый
- Разделители: вертикальная линия "|" или иконка
- Цвета: зелёный для суммы часов, синий для рабочих дней, оранжевый для неполных дней, фиолетовый для дней со статусами
- Шрифт: обычный, размер 14px
- Отступы: padding 10px

---

#### 1.4. Календарный месяц (шахматная доска)

**Расположение:** Основная область интерфейса

**Структура:**
- Отображение всех дней месяца в виде сетки (шахматная доска)
- Каждая ячейка = один день месяца
- Ячейки расположены в календарном порядке (слева направо, сверху вниз)
- Количество строк зависит от количества дней в месяце (28-31 день)
- Оптимальная ширина ячейки: минимум 60px, максимум 120px
- Высота ячейки: минимум 60px, максимум 100px
- Адаптивная сетка: на мобильных устройствах ячейки могут быть меньше, но остаются кликабельными

**Детали сетки:**
- Сетка должна быть выровнена по центру
- Отступы между ячейками: 2-4px
- Границы ячеек: 1px solid (цвет зависит от типа дня)
- Скругление углов: 4px (опционально)

**Визуальное оформление ячеек:**

1. **Обычный рабочий день:**
   - Белый/светлый фон
   - Границы ячеек чёткие

2. **Сегодняшний день:**
   - Визуальное выделение (подсветка, рамка другого цвета)
   - Чёткое определение "сегодняшний день"

3. **Выходные дни:**
   - Визуальное отображение (например, серый фон)
   - Автоматическое определение субботы и воскресенья

4. **Праздничные дни:**
   - Визуальное отображение (например, красный/оранжевый фон)
   - Список праздников должен быть определён (белорусские праздники — см. раздел 5.3.1)
   - Праздничные дни не являются рабочими

5. **Ячейка с рабочими часами:**
   - Отображение количества часов (например, "8 ч")
   - Зелёный/синий фон (успешное заполнение)

6. **Ячейка с особым статусом:**
   - Отображение статуса текстом (например, "Больничный", "Отпуск")
   - Другой визуальный стиль (например, жёлтый/оранжевый фон)
   - Иконка или символ статуса

**Интерактивность:**
- Клик по ячейке открывает форму редактирования дня
- Hover-эффект при наведении на ячейку

---

#### 1.5. Блок управления

**Расположение:** Под календарём или в боковой панели

**Элементы:**

1. **Кнопка "Заполнить неделю"**
   - Групповая кнопка
   - Заполняет текущую неделю одним разом
   - Значение: 8 часов на каждый рабочий день недели
   - Исключает выходные и праздники

**Поведение:**
- При клике определяется текущая неделя (7 дней от понедельника до воскресенья)
- Заполняются только рабочие дни (понедельник-пятница, исключая праздники)
- Выходные и праздники не заполняются
- Подтверждение действия (модальное окно или уведомление)

---

### 2. Редактирование ячейки (дня)

#### 2.1. Ручное редактирование отдельной ячейки

**Способ открытия:**
- Клик по ячейке дня

**Форма редактирования:**

**Вариант 1: Рабочие часы**
- Поле ввода количества часов
- Шаг изменения: 30 минут (0.5 часа)
- Минимальное значение: 0 часов
- Максимальное значение: 24 часа
- Формат: "8.0", "7.5", "4.0" и т.д.
- Визуализация: слайдер или числовое поле с кнопками +/- (шаг 0.5)

**Вариант 2: Особый статус**
- Выбор из списка:
  - **Больничный**
  - **Командировка**
  - **Отпуск календарный**
  - **Отпуск за свой счёт**

**Кнопки формы:**
- "Сохранить" — сохраняет изменения
- "Отмена" — закрывает форму без сохранения

**Валидация:**
- Нельзя указать и часы, и статус одновременно
- При выборе статуса часы обнуляются
- При указании часов статус сбрасывается

**Детали формы редактирования:**

**Рабочие часы:**
- Тип поля: `number` с шагом 0.5
- Минимальное значение: 0
- Максимальное значение: 24
- Формат отображения: "8.0 ч", "7.5 ч", "4.0 ч"
- Визуализация: 
  - Числовое поле с кнопками +/- (шаг 0.5)
  - Или слайдер (range input) с шагом 0.5
  - Или выпадающий список с предустановленными значениями (0, 0.5, 1.0, 1.5, ..., 24.0)
- Валидация в реальном времени: подсветка ошибок при неверном значении

**Особый статус:**
- Тип поля: `select` (выпадающий список)
- Значения:
  - `null` (пусто) — сброс статуса
  - `"Больничный"` — больничный лист
  - `"Командировка"` — командировка
  - `"Отпуск календарный"` — оплачиваемый отпуск
  - `"Отпуск за свой счёт"` — неоплачиваемый отпуск
- Визуализация: иконки для каждого статуса (опционально)

**Кнопки:**
- "Сохранить" — основная кнопка, зелёного цвета
- "Отмена" — вторичная кнопка, серого цвета
- При сохранении показывается индикатор загрузки
- После успешного сохранения форма закрывается автоматически
- При ошибке сохранения показывается сообщение об ошибке

---

### 3. Прелоадер и инициализация

#### 3.1. Прелоадер при первом запуске

**Условие показа:**
- При первом открытии интерфейса
- До определения данных пользователя

**Процесс:**
1. Показывается прелоадер (индикатор загрузки)
2. Выполняется авторизация через Bitrix24 API
3. Определяется текущая дата (месяц, год)
4. Загружаются данные пользователя (ФИО, Должность)
5. Загружаются данные табеля за текущий месяц (если есть)
6. Прелоадер скрывается, отображается интерфейс

**Визуализация:**
- Спиннер или прогресс-бар
- Текст: "Загрузка данных..."
- Фон: полупрозрачный overlay (чтобы заблокировать интерфейс)
- Центрирование: по центру экрана
- Анимация: плавное появление/исчезновение

**Обработка ошибок:**
- Если авторизация не удалась, показывается сообщение об ошибке
- Если данные не загрузились, показывается сообщение с кнопкой "Повторить"
- Таймаут загрузки: 30 секунд

---

### 4. Хранение данных

#### 4.1. Структура хранения

**Формат:** JSON файлы в файловой системе

**Структура папок:**
```
data/
├── {ID_сотрудника}/          # ID пользователя Bitrix24
│   ├── {ГОД}/                # Год (например, 2025)
│   │   ├── {МЕСЯЦ}/          # Месяц (например, 12)
│   │   │   └── data.json     # JSON файл с данными
```

**Пример структуры:**
```
data/
├── 12345/                    # ID сотрудника
│   ├── 2025/
│   │   ├── 01/              # Январь
│   │   │   └── data.json
│   │   ├── 02/              # Февраль
│   │   │   └── data.json
│   │   └── 12/              # Декабрь
│   │       └── data.json
│   └── 2026/
│       └── 01/
│           └── data.json
```

#### 4.2. Формат JSON файла

**Структура:**
```json
{
  "created_at": "2025-12-12T10:51:00+03:00",
  "updated_at": "2025-12-12T15:30:00+03:00",
  "year": 2025,
  "month": 12,
  "user_id": 12345,
  "days": {
    "1": {
      "hours": 8.0,
      "status": null
    },
    "2": {
      "hours": 7.5,
      "status": null
    },
    "3": {
      "hours": 0,
      "status": "Больничный"
    },
    "4": {
      "hours": 0,
      "status": "Отпуск календарный"
    },
    "15": {
      "hours": 4.0,
      "status": null
    }
  }
}
```

**Поля:**
- `created_at` — дата создания файла (ISO 8601)
- `updated_at` — дата последнего обновления (ISO 8601)
- `year` — год
- `month` — месяц (1-12)
- `user_id` — ID пользователя Bitrix24
- `days` — объект с данными по дням
  - Ключ: номер дня месяца (1-31)
  - Значение: объект с полями:
    - `hours` — количество часов (число, может быть 0.5, 1.0, 1.5, и т.д.)
    - `status` — особый статус (строка или null)

**Правила:**
- Если указаны часы (`hours > 0`), то `status` должен быть `null`
- Если указан статус (`status !== null`), то `hours` должен быть `0`
- История изменений не сохраняется (только `created_at` и `updated_at`)

---

## Технические требования

### 5.1. Технологии

**Frontend:**
- Vue.js 3.x (Composition API)
- Компонентный подход
- Интеграция с Bitrix24 BX.* API

**Backend:**
- PHP для обработки запросов
- Работа с файловой системой (создание папок, чтение/запись JSON)
- Bitrix24 REST API для получения данных пользователя

### 5.2. API методы

**Bitrix24 REST API:**
- `user.current` — получение данных текущего пользователя (ФИО, Должность, ID)

**Собственные API endpoints:**
- `GET /api/timesheet/{year}/{month}` — получение данных табеля
- `POST /api/timesheet/{year}/{month}` — сохранение данных табеля
- `GET /api/holidays/{year}` — получение списка праздников за год

#### 5.2.1. Детали API endpoints

**GET /api/timesheet/{year}/{month}**
- **Параметры:**
  - `year` — год (2025-2035)
  - `month` — месяц (1-12)
- **Заголовки:**
  - `Authorization: Bearer {token}` (если требуется)
- **Ответ (успех):**
```json
{
  "success": true,
  "data": {
    "created_at": "2025-12-12T10:51:00+03:00",
    "updated_at": "2025-12-12T15:30:00+03:00",
    "year": 2025,
    "month": 12,
    "user_id": 12345,
    "days": {
      "1": {"hours": 8.0, "status": null},
      "2": {"hours": 7.5, "status": null}
    }
  }
}
```
- **Ответ (ошибка):**
```json
{
  "success": false,
  "error": "File not found",
  "message": "Табель за указанный период не найден"
}
```

**POST /api/timesheet/{year}/{month}**
- **Параметры:**
  - `year` — год (2025-2035)
  - `month` — месяц (1-12)
- **Тело запроса:**
```json
{
  "days": {
    "1": {"hours": 8.0, "status": null},
    "2": {"hours": 7.5, "status": null},
    "3": {"hours": 0, "status": "Больничный"}
  }
}
```
- **Ответ (успех):**
```json
{
  "success": true,
  "message": "Данные сохранены",
  "data": {
    "created_at": "2025-12-12T10:51:00+03:00",
    "updated_at": "2025-12-12T16:00:00+03:00"
  }
}
```
- **Ответ (ошибка валидации):**
```json
{
  "success": false,
  "error": "Validation error",
  "message": "Неверный формат данных",
  "errors": {
    "days.1.hours": "Часы должны быть от 0 до 24"
  }
}
```

**GET /api/holidays/{year}**
- **Параметры:**
  - `year` — год (2025-2035)
- **Ответ:**
```json
{
  "success": true,
  "data": [
    "2025-01-01",
    "2025-01-07",
    "2025-03-08",
    "2025-05-01",
    "2025-05-09",
    "2025-07-03",
    "2025-11-07",
    "2025-12-25"
  ]
}
```

### 5.3. Определение праздников

#### 5.3.1. Белорусские праздники (Республика Беларусь)

**Официальные праздничные дни (нерабочие):**
- **1 января** — Новый год
- **7 января** — Рождество Христово (православное)
- **8 марта** — День женщин
- **1 мая** — Праздник труда
- **9 мая** — День Победы
- **3 июля** — День Независимости Республики Беларусь
- **7 ноября** — День Октябрьской революции
- **25 декабря** — Рождество Христово (католическое)

**Выходные дни:**
- Суббота
- Воскресенье

**Переносы рабочих дней:**
- В Беларуси могут быть переносы рабочих дней (например, если праздник выпадает на выходной)
- Необходимо учитывать актуальный производственный календарь на каждый год
- Рекомендуется хранить календарь праздников в JSON файле с возможностью обновления

**Реализация:**
- Хранить список праздников в конфигурационном файле: `config/holidays-rb.json`
- Формат: массив дат в формате "YYYY-MM-DD"
- Пример структуры:
```json
{
  "2025": [
    "2025-01-01",
    "2025-01-07",
    "2025-03-08",
    "2025-05-01",
    "2025-05-09",
    "2025-07-03",
    "2025-11-07",
    "2025-12-25"
  ],
  "2026": [...]
}
```

**API endpoint:**
- `GET /api/holidays/{year}` — возвращает массив праздничных дат за указанный год
- Формат ответа: `["2025-01-01", "2025-01-07", ...]`

---

## Визуальные требования

### 6.1. Цветовая схема

**Рабочие дни:**
- Фон: белый/светло-серый
- Текст: чёрный

**Сегодняшний день:**
- Фон: светло-синий/голубой
- Рамка: синяя, жирная
- Текст: чёрный/синий

**Выходные дни:**
- Фон: светло-серый
- Текст: серый

**Праздничные дни:**
- Фон: светло-красный/оранжевый
- Текст: красный/чёрный

**Заполненные дни (8 часов):**
- Фон: светло-зелёный
- Текст: зелёный/чёрный

**Неполные дни (< 8 часов):**
- Фон: светло-жёлтый
- Текст: оранжевый/чёрный

**Дни со статусами:**
- Больничный: светло-красный фон
- Командировка: светло-фиолетовый фон
- Отпуск календарный: светло-голубой фон
- Отпуск за свой счёт: светло-оранжевый фон

### 6.2. Адаптивность

- Интерфейс должен быть адаптивным для мобильных устройств
- Календарь должен корректно отображаться на экранах разных размеров
- Выпадающие списки должны работать на мобильных устройствах

**Breakpoints:**
- Desktop: ≥ 1024px (полная сетка календаря, все элементы видны)
- Tablet: 768px - 1023px (сетка календаря, возможно уменьшение размера ячеек)
- Mobile: < 768px (адаптивная сетка, ячейки могут быть меньше, но остаются кликабельными)

**Адаптивные элементы:**
- Календарь: на мобильных устройствах может отображаться в одну колонку или уменьшенная сетка
- Статистика: на мобильных устройствах может отображаться в несколько строк
- Форма редактирования: на мобильных устройствах занимает весь экран (модальное окно)
- Выпадающие списки: на мобильных устройствах используют нативные элементы выбора

**Touch-оптимизация:**
- Минимальный размер кликабельной области: 44x44px (для touch-устройств)
- Swipe-жесты: возможность переключения месяцев свайпом (опционально)

---

## Функциональные требования

### 7.1. Автоматическое заполнение недели

**Условия:**
- Заполняются только рабочие дни (понедельник-пятница)
- Выходные дни не заполняются
- Праздничные дни не заполняются
- Значение: 8 часов на каждый рабочий день

**Поведение:**
- При клике на кнопку "Заполнить неделю" определяется текущая неделя
- Неделя считается от понедельника до воскресенья
- Если сегодня среда, то заполняются дни с понедельника по пятницу текущей недели
- Если день уже заполнен, он перезаписывается (или пропускается — уточнить)

### 7.2. Валидация данных

**Правила:**
- Часы: от 0 до 24, шаг 0.5
- Статус и часы не могут быть указаны одновременно
- Нельзя заполнить выходной день рабочими часами (только статусом)
- Нельзя заполнить праздничный день рабочими часами (только статусом)

**Детали валидации:**

**На фронтенде (Vue.js):**
- Валидация в реальном времени при вводе
- Подсветка полей с ошибками (красная рамка)
- Сообщения об ошибках под полями
- Блокировка кнопки "Сохранить" при наличии ошибок

**На бэкенде (PHP):**
- Валидация всех входящих данных
- Проверка формата JSON
- Проверка типов данных (hours — число, status — строка или null)
- Проверка диапазонов (hours: 0-24, шаг 0.5)
- Проверка правил (часы и статус не могут быть одновременно)
- Проверка прав доступа (пользователь может редактировать только свой табель)

**Обработка ошибок:**
- Если валидация не прошла, возвращается детальное описание ошибок
- Если файл не найден, создаётся новый файл
- Если нет прав на запись, возвращается ошибка доступа
- Все ошибки логируются в `logs/`

### 7.3. Автосохранение

**Варианты:**
- Автосохранение при изменении (debounce 1-2 секунды)
- Или сохранение по кнопке "Сохранить" в форме редактирования

**Рекомендация:** Автосохранение с debounce для лучшего UX

**Детали автосохранения:**
- Debounce: 1.5 секунды (после последнего изменения)
- Показ индикатора сохранения: "Сохранение..." (в углу экрана или рядом с кнопкой)
- Уведомление об успешном сохранении: "Данные сохранены" (зелёное уведомление, исчезает через 2 секунды)
- Обработка ошибок: при ошибке сохранения показывается сообщение "Ошибка сохранения. Попробуйте ещё раз."
- Retry: автоматическая повторная попытка сохранения при ошибке (максимум 3 попытки)
- Офлайн режим: при отсутствии интернета данные сохраняются в localStorage, синхронизация при восстановлении связи

---

## Критерии приёмки

### 8.1. Функциональные

- [ ] Отображается ФИО и Должность пользователя
- [ ] Работает выбор месяца и года (2025-2035)
- [ ] Отображается календарный месяц в виде шахматной доски
- [ ] Визуально выделяется сегодняшний день
- [ ] Визуально отображаются выходные дни
- [ ] Визуально отображаются праздничные дни
- [ ] Работает кнопка "Заполнить неделю" (8 часов на рабочие дни)
- [ ] Работает редактирование отдельной ячейки
- [ ] Можно указать часы с шагом 30 минут
- [ ] Можно указать особые статусы (Больничный, Командировка, Отпуск календарный, Отпуск за свой счёт)
- [ ] Отображается статистика (сумма часов, рабочих дней, неполных дней, дней со статусами)
- [ ] Данные сохраняются в структуре: ID_сотрудника/ГОД/МЕСЯЦ/data.json
- [ ] JSON файл содержит created_at, updated_at, days
- [ ] Показывается прелоадер при первом запуске

### 8.2. Технические

- [ ] Используется Vue.js 3.x
- [ ] Компонентный подход
- [ ] Интеграция с Bitrix24 API
- [ ] Работа с файловой системой (создание папок, чтение/запись JSON)
- [ ] Валидация данных на фронтенде и бэкенде
- [ ] Обработка ошибок
- [ ] Логирование операций

### 8.3. Визуальные

- [ ] Адаптивный дизайн
- [ ] Соответствие гайдлайнам Bitrix24
- [ ] Корректное отображение на мобильных устройствах
- [ ] Визуальное выделение различных типов дней

---

## Примеры использования

### 9.1. Сценарий 1: Заполнение недели

1. Пользователь открывает интерфейс
2. Видит календарь текущего месяца
3. Кликает на кнопку "Заполнить неделю"
4. Система определяет текущую неделю (понедельник-пятница)
5. Заполняет все рабочие дни значением 8 часов
6. Выходные и праздники остаются незаполненными
7. Статистика обновляется автоматически

### 9.2. Сценарий 2: Ручное редактирование дня

1. Пользователь кликает на ячейку дня (например, 15 число)
2. Открывается форма редактирования
3. Пользователь выбирает "Рабочие часы"
4. Устанавливает значение 7.5 часов (слайдер или поле ввода)
5. Кликает "Сохранить"
6. Ячейка обновляется, отображается "7.5 ч"
7. Статистика обновляется (добавляется неполный день)

### 9.3. Сценарий 3: Указание статуса

1. Пользователь кликает на ячейку дня
2. Открывается форма редактирования
3. Пользователь выбирает "Особый статус"
4. Выбирает "Больничный" из списка
5. Кликает "Сохранить"
6. Ячейка обновляется, отображается "Больничный" с соответствующим визуальным стилем
7. Статистика обновляется (добавляется день со статусом)

---

## Архитектура компонентов Vue.js

### 10.1. Структура компонентов

**Основные компоненты:**
```
TimesheetCalendar/
├── TimesheetCalendar.vue          # Корневой компонент
├── components/
│   ├── UserInfo.vue               # Блок авторизации (ФИО, Должность)
│   ├── PeriodSelector.vue         # Блок выбора месяца/года
│   ├── StatisticsBar.vue          # Блок статистики
│   ├── CalendarGrid.vue           # Календарная сетка (шахматная доска)
│   │   └── CalendarCell.vue       # Ячейка дня
│   ├── EditDayModal.vue           # Модальное окно редактирования дня
│   ├── FillWeekButton.vue         # Кнопка "Заполнить неделю"
│   └── Preloader.vue              # Прелоадер
├── services/
│   ├── Bitrix24ApiService.js      # Сервис для работы с Bitrix24 API
│   ├── TimesheetApiService.js     # Сервис для работы с табелем
│   └── HolidaysService.js         # Сервис для работы с праздниками
├── stores/
│   └── timesheetStore.js          # Состояние приложения (Vuex/Pinia)
└── utils/
    ├── dateHelpers.js             # Утилиты для работы с датами
    ├── validation.js              # Утилиты валидации
    └── constants.js               # Константы (статусы, цвета)
```

### 10.2. Состояние приложения (Store)

**Структура состояния:**
```javascript
{
  user: {
    id: null,
    name: null,
    position: null,
    loading: false,
    error: null
  },
  timesheet: {
    year: 2025,
    month: 12,
    days: {},
    loading: false,
    error: null,
    saving: false
  },
  holidays: {
    year: 2025,
    dates: [],
    loading: false,
    error: null
  },
  ui: {
    preloader: true,
    editModal: {
      open: false,
      day: null,
      year: null,
      month: null
    }
  }
}
```

### 10.3. Обработка ошибок

**Типы ошибок:**
- Ошибки сети (timeout, connection refused)
- Ошибки API (404, 500, validation errors)
- Ошибки авторизации (401, 403)
- Ошибки валидации данных

**Обработка:**
- Все ошибки логируются в консоль (development) или отправляются на сервер (production)
- Пользователю показываются понятные сообщения об ошибках
- Критические ошибки блокируют интерфейс с предложением перезагрузить страницу
- Некритические ошибки показываются как уведомления

### 10.4. Производительность

**Оптимизация:**
- Ленивая загрузка компонентов (lazy loading)
- Виртуализация календаря (если дней много)
- Мемоизация вычислений (computed properties)
- Debounce для автосохранения
- Кэширование данных в памяти
- Минификация и сжатие для production

**Метрики:**
- Время загрузки страницы: < 2 секунд
- Время ответа API: < 500ms
- Размер бандла: < 500KB (gzipped)
- FPS при анимациях: ≥ 60

### 10.5. Безопасность

**Frontend:**
- Валидация всех входящих данных
- Санитизация вывода (XSS protection)
- CSRF защита (если требуется)
- Хранение токенов в безопасном месте (не в localStorage для production)

**Backend:**
- Валидация всех входящих данных
- Проверка прав доступа (пользователь может редактировать только свой табель)
- Санитизация путей файлов (защита от path traversal)
- Логирование всех операций
- Ограничение размера запросов

### 10.6. Локализация

**Языки:**
- Русский (по умолчанию)
- Белорусский (опционально)

**Локализуемые элементы:**
- Названия месяцев
- Названия статусов
- Сообщения об ошибках
- Тексты кнопок
- Подсказки

**Реализация:**
- Использование i18n библиотеки (vue-i18n)
- Хранение переводов в JSON файлах
- Определение языка из настроек пользователя Bitrix24

### 10.7. Часовой пояс

**Настройки:**
- Часовой пояс: UTC+3 (Брест, Республика Беларусь)
- Все даты и время хранятся в формате ISO 8601 с указанием часового пояса
- Отображение дат в локальном времени пользователя

**Обработка:**
- Определение текущего времени на сервере
- Синхронизация с часовым поясом Bitrix24 (если отличается)

---

## История изменений

- **2025-12-12 10:51 (UTC+3, Брест):** Создано первое детальное техническое задание на интерфейс табеля присутствия
- **2025-12-12 10:58 (UTC+3, Брест):** Дополнено деталями: белорусские праздники, детали API, архитектура компонентов Vue.js, обработка ошибок, производительность, безопасность, локализация

---

## Примечания

Это первоисточник технического задания, созданный на основе детального описания задачи. Все детали будут уточняться в процессе разработки.

**Следующие шаги:**
1. Создать задачи в `DOCS/TASKS/` на основе этого ТЗ
2. Разбить на подзадачи для разработки
3. Определить приоритеты и сроки

---

## Дополнительные детали

### 11.1. Граничные случаи

**Пустой месяц:**
- Если месяц ещё не заполнен, все ячейки пустые
- При первом заполнении создаётся файл `data.json`

**Неполный месяц:**
- Если месяц имеет 28, 29, 30 или 31 день, сетка адаптируется
- Лишние ячейки не отображаются

**Прошедшие дни:**
- Прошедшие дни можно редактировать (для исправления ошибок)
- Будущие дни можно заполнять заранее

**Переход между месяцами:**
- При переходе на другой месяц данные текущего месяца сохраняются автоматически
- При возврате к предыдущему месяцу данные загружаются из кэша или с сервера

### 11.2. Интеграция с Bitrix24

**Использование BX.* API:**
- `BX.ready()` — инициализация при загрузке
- `BX.ajax()` — для запросов к собственным API (опционально)
- `BX.UI.Notification` — для уведомлений
- `BX.PopupWindow` — для модальных окон (опционально)

**Синхронизация данных:**
- Данные табеля хранятся локально (файловая система)
- Возможна будущая синхронизация с Bitrix24 (если потребуется)

### 11.3. Тестирование

**Unit-тесты:**
- Тесты компонентов Vue.js
- Тесты утилит (dateHelpers, validation)
- Тесты сервисов (API services)

**Интеграционные тесты:**
- Тесты API endpoints
- Тесты работы с файловой системой
- Тесты валидации данных

**E2E тесты:**
- Тесты основных сценариев использования
- Тесты на разных устройствах (desktop, tablet, mobile)

### 11.4. Документация кода

**Комментарии:**
- JSDoc для всех функций и методов
- Комментарии к сложным участкам кода
- Описание компонентов Vue.js

**README:**
- Инструкция по установке и настройке
- Описание структуры проекта
- Примеры использования API

---

**Версия документа:** 1.1  
**Последнее обновление:** 2025-12-12 10:58 (UTC+3, Брест)  
**Регион:** Республика Беларусь (РБ)

