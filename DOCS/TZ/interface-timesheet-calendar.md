# Техническое задание: Интерфейс табеля присутствия (Календарный месяц)

**Дата создания:** 2025-12-12 10:51 (UTC+3, Брест)  
**Версия:** 1.0 (Первое детальное ТЗ)  
**Статус:** Черновик  
**Описание:** Детальное техническое задание на интерфейс табеля присутствия с календарным отображением месяца

---

## Общая информация

### Название задачи
**Интерфейс табеля присутствия (Календарный месяц)**

### Цель
Создание интерфейса для заполнения табеля присутствия сотрудниками с отображением календарного месяца в виде шахматной доски (все дни месяца).

---

## Описание интерфейса

### 1. Структура интерфейса

#### 1.1. Блок авторизации и информации о пользователе

**Расположение:** Верхняя часть интерфейса

**Содержимое:**
- **ФИО** — полное имя сотрудника
- **Должность** — должность сотрудника

**Источник данных:** Bitrix24 REST API (`user.current`)

**Визуальное оформление:**
- Отображается первой строкой
- Чёткое визуальное выделение
- Формат: "Иванов Иван Иванович | Менеджер по продажам"

---

#### 1.2. Блок выбора периода

**Расположение:** Под блоком авторизации

**Элементы:**
- **Выбор месяца:** Выпадающий список с прокруткой
  - Значения: Январь, Февраль, Март, Апрель, Май, Июнь, Июль, Август, Сентябрь, Октябрь, Ноябрь, Декабрь
  - По умолчанию: текущий месяц

- **Выбор года:** Выпадающий список с прокруткой
  - Диапазон: 2025-2035 (10 лет вперёд)
  - По умолчанию: текущий год

**Поведение:**
- При изменении месяца/года обновляется календарь
- Сохраняется выбранный период в состоянии приложения

---

#### 1.3. Блок статистики

**Расположение:** Под блоком выбора периода

**Содержимое (одна строка, разделённая):**
1. **Сумма часов всего** — общее количество отработанных часов за выбранный месяц
2. **Сумма дней календарных рабочих** — количество дней, где есть хотя бы один рабочий час (факт работы)
3. **Сумма неполных дней** — количество дней, где менее 8 часов
4. **Сумма дней со статусами** — количество дней с особыми статусами (Отпуск, Больничный, Командировка, Отпуск за свой счёт)

**Формат отображения:**
```
Сумма часов: 160 | Рабочих дней: 20 | Неполных дней: 2 | Дней со статусами: 3
```

**Обновление:** Статистика обновляется автоматически при изменении данных

---

#### 1.4. Календарный месяц (шахматная доска)

**Расположение:** Основная область интерфейса

**Структура:**
- Отображение всех дней месяца в виде сетки (шахматная доска)
- Каждая ячейка = один день месяца
- Ячейки расположены в календарном порядке (слева направо, сверху вниз)

**Визуальное оформление ячеек:**

1. **Обычный рабочий день:**
   - Белый/светлый фон
   - Границы ячеек чёткие

2. **Сегодняшний день:**
   - Визуальное выделение (подсветка, рамка другого цвета)
   - Чёткое определение "сегодняшний день"

3. **Выходные дни:**
   - Визуальное отображение (например, серый фон)
   - Автоматическое определение субботы и воскресенья

4. **Праздничные дни:**
   - Визуальное отображение (например, красный/оранжевый фон)
   - Список праздников должен быть определён (российские праздники)

5. **Ячейка с рабочими часами:**
   - Отображение количества часов (например, "8 ч")
   - Зелёный/синий фон (успешное заполнение)

6. **Ячейка с особым статусом:**
   - Отображение статуса текстом (например, "Больничный", "Отпуск")
   - Другой визуальный стиль (например, жёлтый/оранжевый фон)
   - Иконка или символ статуса

**Интерактивность:**
- Клик по ячейке открывает форму редактирования дня
- Hover-эффект при наведении на ячейку

---

#### 1.5. Блок управления

**Расположение:** Под календарём или в боковой панели

**Элементы:**

1. **Кнопка "Заполнить неделю"**
   - Групповая кнопка
   - Заполняет текущую неделю одним разом
   - Значение: 8 часов на каждый рабочий день недели
   - Исключает выходные и праздники

**Поведение:**
- При клике определяется текущая неделя (7 дней от понедельника до воскресенья)
- Заполняются только рабочие дни (понедельник-пятница, исключая праздники)
- Выходные и праздники не заполняются
- Подтверждение действия (модальное окно или уведомление)

---

### 2. Редактирование ячейки (дня)

#### 2.1. Ручное редактирование отдельной ячейки

**Способ открытия:**
- Клик по ячейке дня

**Форма редактирования:**

**Вариант 1: Рабочие часы**
- Поле ввода количества часов
- Шаг изменения: 30 минут (0.5 часа)
- Минимальное значение: 0 часов
- Максимальное значение: 24 часа
- Формат: "8.0", "7.5", "4.0" и т.д.
- Визуализация: слайдер или числовое поле с кнопками +/- (шаг 0.5)

**Вариант 2: Особый статус**
- Выбор из списка:
  - **Больничный**
  - **Командировка**
  - **Отпуск календарный**
  - **Отпуск за свой счёт**

**Кнопки формы:**
- "Сохранить" — сохраняет изменения
- "Отмена" — закрывает форму без сохранения

**Валидация:**
- Нельзя указать и часы, и статус одновременно
- При выборе статуса часы обнуляются
- При указании часов статус сбрасывается

---

### 3. Прелоадер и инициализация

#### 3.1. Прелоадер при первом запуске

**Условие показа:**
- При первом открытии интерфейса
- До определения данных пользователя

**Процесс:**
1. Показывается прелоадер (индикатор загрузки)
2. Выполняется авторизация через Bitrix24 API
3. Определяется текущая дата (месяц, год)
4. Загружаются данные пользователя (ФИО, Должность)
5. Загружаются данные табеля за текущий месяц (если есть)
6. Прелоадер скрывается, отображается интерфейс

**Визуализация:**
- Спиннер или прогресс-бар
- Текст: "Загрузка данных..."

---

### 4. Хранение данных

#### 4.1. Структура хранения

**Формат:** JSON файлы в файловой системе

**Структура папок:**
```
data/
├── {ID_сотрудника}/          # ID пользователя Bitrix24
│   ├── {ГОД}/                # Год (например, 2025)
│   │   ├── {МЕСЯЦ}/          # Месяц (например, 12)
│   │   │   └── data.json     # JSON файл с данными
```

**Пример структуры:**
```
data/
├── 12345/                    # ID сотрудника
│   ├── 2025/
│   │   ├── 01/              # Январь
│   │   │   └── data.json
│   │   ├── 02/              # Февраль
│   │   │   └── data.json
│   │   └── 12/              # Декабрь
│   │       └── data.json
│   └── 2026/
│       └── 01/
│           └── data.json
```

#### 4.2. Формат JSON файла

**Структура:**
```json
{
  "created_at": "2025-12-12T10:51:00+03:00",
  "updated_at": "2025-12-12T15:30:00+03:00",
  "year": 2025,
  "month": 12,
  "user_id": 12345,
  "days": {
    "1": {
      "hours": 8.0,
      "status": null
    },
    "2": {
      "hours": 7.5,
      "status": null
    },
    "3": {
      "hours": 0,
      "status": "Больничный"
    },
    "4": {
      "hours": 0,
      "status": "Отпуск календарный"
    },
    "15": {
      "hours": 4.0,
      "status": null
    }
  }
}
```

**Поля:**
- `created_at` — дата создания файла (ISO 8601)
- `updated_at` — дата последнего обновления (ISO 8601)
- `year` — год
- `month` — месяц (1-12)
- `user_id` — ID пользователя Bitrix24
- `days` — объект с данными по дням
  - Ключ: номер дня месяца (1-31)
  - Значение: объект с полями:
    - `hours` — количество часов (число, может быть 0.5, 1.0, 1.5, и т.д.)
    - `status` — особый статус (строка или null)

**Правила:**
- Если указаны часы (`hours > 0`), то `status` должен быть `null`
- Если указан статус (`status !== null`), то `hours` должен быть `0`
- История изменений не сохраняется (только `created_at` и `updated_at`)

---

## Технические требования

### 5.1. Технологии

**Frontend:**
- Vue.js 3.x (Composition API)
- Компонентный подход
- Интеграция с Bitrix24 BX.* API

**Backend:**
- PHP для обработки запросов
- Работа с файловой системой (создание папок, чтение/запись JSON)
- Bitrix24 REST API для получения данных пользователя

### 5.2. API методы

**Bitrix24 REST API:**
- `user.current` — получение данных текущего пользователя (ФИО, Должность, ID)

**Собственные API endpoints:**
- `GET /api/timesheet/{year}/{month}` — получение данных табеля
- `POST /api/timesheet/{year}/{month}` — сохранение данных табеля
- `GET /api/holidays/{year}` — получение списка праздников за год

### 5.3. Определение праздников

**Источник:**
- Список российских праздников (фиксированный или через API)
- Выходные дни (суббота, воскресенье)

**Реализация:**
- Можно использовать библиотеку для определения праздников
- Или хранить список праздников в конфигурационном файле

---

## Визуальные требования

### 6.1. Цветовая схема

**Рабочие дни:**
- Фон: белый/светло-серый
- Текст: чёрный

**Сегодняшний день:**
- Фон: светло-синий/голубой
- Рамка: синяя, жирная
- Текст: чёрный/синий

**Выходные дни:**
- Фон: светло-серый
- Текст: серый

**Праздничные дни:**
- Фон: светло-красный/оранжевый
- Текст: красный/чёрный

**Заполненные дни (8 часов):**
- Фон: светло-зелёный
- Текст: зелёный/чёрный

**Неполные дни (< 8 часов):**
- Фон: светло-жёлтый
- Текст: оранжевый/чёрный

**Дни со статусами:**
- Больничный: светло-красный фон
- Командировка: светло-фиолетовый фон
- Отпуск календарный: светло-голубой фон
- Отпуск за свой счёт: светло-оранжевый фон

### 6.2. Адаптивность

- Интерфейс должен быть адаптивным для мобильных устройств
- Календарь должен корректно отображаться на экранах разных размеров
- Выпадающие списки должны работать на мобильных устройствах

---

## Функциональные требования

### 7.1. Автоматическое заполнение недели

**Условия:**
- Заполняются только рабочие дни (понедельник-пятница)
- Выходные дни не заполняются
- Праздничные дни не заполняются
- Значение: 8 часов на каждый рабочий день

**Поведение:**
- При клике на кнопку "Заполнить неделю" определяется текущая неделя
- Неделя считается от понедельника до воскресенья
- Если сегодня среда, то заполняются дни с понедельника по пятницу текущей недели
- Если день уже заполнен, он перезаписывается (или пропускается — уточнить)

### 7.2. Валидация данных

**Правила:**
- Часы: от 0 до 24, шаг 0.5
- Статус и часы не могут быть указаны одновременно
- Нельзя заполнить выходной день рабочими часами (только статусом)
- Нельзя заполнить праздничный день рабочими часами (только статусом)

### 7.3. Автосохранение

**Варианты:**
- Автосохранение при изменении (debounce 1-2 секунды)
- Или сохранение по кнопке "Сохранить" в форме редактирования

**Рекомендация:** Автосохранение с debounce для лучшего UX

---

## Критерии приёмки

### 8.1. Функциональные

- [ ] Отображается ФИО и Должность пользователя
- [ ] Работает выбор месяца и года (2025-2035)
- [ ] Отображается календарный месяц в виде шахматной доски
- [ ] Визуально выделяется сегодняшний день
- [ ] Визуально отображаются выходные дни
- [ ] Визуально отображаются праздничные дни
- [ ] Работает кнопка "Заполнить неделю" (8 часов на рабочие дни)
- [ ] Работает редактирование отдельной ячейки
- [ ] Можно указать часы с шагом 30 минут
- [ ] Можно указать особые статусы (Больничный, Командировка, Отпуск календарный, Отпуск за свой счёт)
- [ ] Отображается статистика (сумма часов, рабочих дней, неполных дней, дней со статусами)
- [ ] Данные сохраняются в структуре: ID_сотрудника/ГОД/МЕСЯЦ/data.json
- [ ] JSON файл содержит created_at, updated_at, days
- [ ] Показывается прелоадер при первом запуске

### 8.2. Технические

- [ ] Используется Vue.js 3.x
- [ ] Компонентный подход
- [ ] Интеграция с Bitrix24 API
- [ ] Работа с файловой системой (создание папок, чтение/запись JSON)
- [ ] Валидация данных на фронтенде и бэкенде
- [ ] Обработка ошибок
- [ ] Логирование операций

### 8.3. Визуальные

- [ ] Адаптивный дизайн
- [ ] Соответствие гайдлайнам Bitrix24
- [ ] Корректное отображение на мобильных устройствах
- [ ] Визуальное выделение различных типов дней

---

## Примеры использования

### 9.1. Сценарий 1: Заполнение недели

1. Пользователь открывает интерфейс
2. Видит календарь текущего месяца
3. Кликает на кнопку "Заполнить неделю"
4. Система определяет текущую неделю (понедельник-пятница)
5. Заполняет все рабочие дни значением 8 часов
6. Выходные и праздники остаются незаполненными
7. Статистика обновляется автоматически

### 9.2. Сценарий 2: Ручное редактирование дня

1. Пользователь кликает на ячейку дня (например, 15 число)
2. Открывается форма редактирования
3. Пользователь выбирает "Рабочие часы"
4. Устанавливает значение 7.5 часов (слайдер или поле ввода)
5. Кликает "Сохранить"
6. Ячейка обновляется, отображается "7.5 ч"
7. Статистика обновляется (добавляется неполный день)

### 9.3. Сценарий 3: Указание статуса

1. Пользователь кликает на ячейку дня
2. Открывается форма редактирования
3. Пользователь выбирает "Особый статус"
4. Выбирает "Больничный" из списка
5. Кликает "Сохранить"
6. Ячейка обновляется, отображается "Больничный" с соответствующим визуальным стилем
7. Статистика обновляется (добавляется день со статусом)

---

## История изменений

- **2025-12-12 10:51 (UTC+3, Брест):** Создано первое детальное техническое задание на интерфейс табеля присутствия

---

## Примечания

Это первоисточник технического задания, созданный на основе детального описания задачи. Все детали будут уточняться в процессе разработки.

**Следующие шаги:**
1. Создать задачи в `DOCS/TASKS/` на основе этого ТЗ
2. Разбить на подзадачи для разработки
3. Определить приоритеты и сроки

