# Этапы реализации интерфейса табеля присутствия

**Дата создания:** 2025-12-12 11:00 (UTC+3, Брест)  
**Версия:** 1.0  
**Описание:** Глобальные этапы реализации задачи "Интерфейс табеля присутствия (Календарный месяц)"

---

## Общая информация

**Количество глобальных этапов:** 7  
**Ориентировочная длительность:** 6-8 недель (при работе одного разработчика)

---

## Этап 1: Подготовка инфраструктуры и окружения

**Длительность:** 3-5 дней  
**Приоритет:** Критический  
**Зависимости:** Нет

### Задачи:
1. Настройка структуры проекта для Vue.js
   - Создание папок `js/vue-apps/timesheet/`
   - Настройка npm и package.json
   - Установка зависимостей (Vue.js 3.x, сборщик)

2. Настройка сборщика (Vite/Webpack)
   - Конфигурация сборки
   - Настройка dev-сервера
   - Настройка production-сборки

3. Создание структуры папок для данных
   - Папка `data/` для хранения JSON файлов
   - Настройка прав доступа (775 для папок, 664 для файлов)

4. Создание конфигурационного файла праздников
   - Файл `config/holidays-rb.json`
   - Заполнение праздников на 2025-2035 годы

5. Настройка базовой структуры компонентов
   - Создание пустых файлов компонентов
   - Настройка роутинга (если требуется)

### Результат:
- ✅ Готовая структура проекта
- ✅ Настроенный сборщик
- ✅ Рабочее окружение для разработки

---

## Этап 2: Backend API (PHP endpoints)

**Длительность:** 5-7 дней  
**Приоритет:** Критический  
**Зависимости:** Этап 1

### Задачи:
1. Создание API endpoint для получения данных табеля
   - `GET /api/timesheet/{year}/{month}`
   - Чтение JSON файла из файловой системы
   - Обработка случая отсутствия файла
   - Валидация параметров (year, month)

2. Создание API endpoint для сохранения данных табеля
   - `POST /api/timesheet/{year}/{month}`
   - Создание структуры папок (если не существует)
   - Запись/обновление JSON файла
   - Валидация входящих данных
   - Обновление `updated_at`

3. Создание API endpoint для получения праздников
   - `GET /api/holidays/{year}`
   - Чтение из `config/holidays-rb.json`
   - Кэширование (опционально)

4. Реализация валидации данных
   - Валидация структуры JSON
   - Валидация типов данных (hours, status)
   - Валидация правил (часы и статус не одновременно)
   - Валидация диапазонов (hours: 0-24, шаг 0.5)

5. Реализация безопасности
   - Проверка прав доступа (пользователь может редактировать только свой табель)
   - Санитизация путей файлов (защита от path traversal)
   - Логирование операций

6. Обработка ошибок
   - Обработка всех типов ошибок
   - Возврат понятных сообщений об ошибках
   - Логирование в `logs/`

### Результат:
- ✅ Рабочие API endpoints
- ✅ Валидация и безопасность
- ✅ Обработка ошибок

---

## Этап 3: Сервисы и утилиты (JavaScript)

**Длительность:** 3-4 дня  
**Приоритет:** Высокий  
**Зависимости:** Этап 2

### Задачи:
1. Создание сервиса для работы с Bitrix24 API
   - `Bitrix24ApiService.js`
   - Метод получения данных пользователя (`user.current`)
   - Интеграция с BX.* API

2. Создание сервиса для работы с табелем
   - `TimesheetApiService.js`
   - Методы получения и сохранения данных табеля
   - Обработка ошибок API

3. Создание сервиса для работы с праздниками
   - `HolidaysService.js`
   - Метод получения праздников за год
   - Кэширование данных

4. Создание утилит для работы с датами
   - `dateHelpers.js`
   - Определение сегодняшнего дня
   - Определение выходных дней
   - Определение праздничных дней
   - Определение количества дней в месяце
   - Определение текущей недели

5. Создание утилит валидации
   - `validation.js`
   - Валидация часов (0-24, шаг 0.5)
   - Валидация статусов
   - Валидация правил (часы и статус не одновременно)

6. Создание констант
   - `constants.js`
   - Статусы (Больничный, Командировка, и т.д.)
   - Цвета для разных типов дней
   - Конфигурация (диапазон лет, шаг часов)

### Результат:
- ✅ Все сервисы и утилиты готовы
- ✅ Интеграция с Bitrix24 API
- ✅ Утилиты для работы с датами и валидацией

---

## Этап 4: Базовые компоненты Vue.js

**Длительность:** 5-7 дней  
**Приоритет:** Критический  
**Зависимости:** Этап 3

### Задачи:
1. Компонент прелоадера
   - `Preloader.vue`
   - Индикатор загрузки
   - Overlay с блокировкой интерфейса

2. Компонент информации о пользователе
   - `UserInfo.vue`
   - Отображение ФИО и Должности
   - Загрузка данных через Bitrix24 API

3. Компонент выбора периода
   - `PeriodSelector.vue`
   - Выбор месяца (выпадающий список)
   - Выбор года (выпадающий список)
   - Обработка изменения периода

4. Компонент статистики
   - `StatisticsBar.vue`
   - Расчёт и отображение статистики
   - Реактивное обновление при изменении данных

5. Компонент ячейки дня
   - `CalendarCell.vue`
   - Отображение дня месяца
   - Визуальное выделение (сегодня, выходные, праздники)
   - Отображение часов или статуса
   - Обработка клика

6. Компонент календарной сетки
   - `CalendarGrid.vue`
   - Отображение всех дней месяца в виде сетки
   - Интеграция с `CalendarCell.vue`
   - Определение типа дня (рабочий, выходной, праздник)

### Результат:
- ✅ Все базовые компоненты готовы
- ✅ Отображение календаря работает
- ✅ Интеграция с данными

---

## Этап 5: Функциональные компоненты и логика

**Длительность:** 7-10 дней  
**Приоритет:** Критический  
**Зависимости:** Этап 4

### Задачи:
1. Компонент модального окна редактирования дня
   - `EditDayModal.vue`
   - Форма редактирования (часы или статус)
   - Валидация в реальном времени
   - Кнопки "Сохранить" и "Отмена"
   - Обработка сохранения

2. Компонент кнопки "Заполнить неделю"
   - `FillWeekButton.vue`
   - Определение текущей недели
   - Заполнение рабочих дней (8 часов)
   - Исключение выходных и праздников
   - Подтверждение действия

3. Реализация состояния приложения (Store)
   - `timesheetStore.js` (Vuex/Pinia)
   - Состояние пользователя
   - Состояние табеля
   - Состояние праздников
   - Состояние UI (прелоадер, модальное окно)

4. Реализация автосохранения
   - Debounce для автосохранения (1.5 секунды)
   - Индикатор сохранения
   - Обработка ошибок сохранения
   - Retry при ошибках

5. Реализация расчёта статистики
   - Сумма часов всего
   - Сумма рабочих дней
   - Сумма неполных дней
   - Сумма дней со статусами

6. Интеграция всех компонентов
   - Связывание компонентов через Store
   - Обработка событий между компонентами
   - Обновление данных при изменениях

### Результат:
- ✅ Полностью функциональный интерфейс
- ✅ Редактирование дней работает
- ✅ Заполнение недели работает
- ✅ Статистика рассчитывается и отображается

---

## Этап 6: Стилизация и адаптивность

**Длительность:** 4-5 дней  
**Приоритет:** Высокий  
**Зависимости:** Этап 5

### Задачи:
1. Стилизация календарной сетки
   - Размеры ячеек
   - Отступы и границы
   - Цветовая схема для разных типов дней
   - Визуальное выделение сегодняшнего дня

2. Стилизация компонентов
   - Стили для всех компонентов
   - Соответствие гайдлайнам Bitrix24
   - Единый стиль интерфейса

3. Адаптивность для мобильных устройств
   - Breakpoints (desktop, tablet, mobile)
   - Адаптивная сетка календаря
   - Адаптивные формы и модальные окна
   - Touch-оптимизация

4. Анимации и переходы
   - Плавные переходы при изменении данных
   - Анимация открытия/закрытия модальных окон
   - Анимация загрузки

5. Оптимизация производительности
   - Ленивая загрузка компонентов
   - Мемоизация вычислений
   - Оптимизация рендеринга календаря

### Результат:
- ✅ Полностью стилизованный интерфейс
- ✅ Адаптивный дизайн
- ✅ Оптимизированная производительность

---

## Этап 7: Тестирование, оптимизация и документация

**Длительность:** 5-7 дней  
**Приоритет:** Высокий  
**Зависимости:** Этап 6

### Задачи:
1. Unit-тесты
   - Тесты компонентов Vue.js
   - Тесты утилит (dateHelpers, validation)
   - Тесты сервисов (API services)

2. Интеграционные тесты
   - Тесты API endpoints
   - Тесты работы с файловой системой
   - Тесты валидации данных

3. E2E тесты
   - Тесты основных сценариев использования
   - Тесты на разных устройствах

4. Исправление ошибок
   - Исправление найденных багов
   - Оптимизация производительности
   - Улучшение UX

5. Документация
   - Комментарии в коде (JSDoc)
   - README с инструкциями
   - Описание API endpoints

6. Финальная проверка
   - Проверка всех критериев приёмки
   - Проверка на разных браузерах
   - Проверка на разных устройствах

### Результат:
- ✅ Протестированное приложение
- ✅ Исправлены все ошибки
- ✅ Готовая документация
- ✅ Готово к production

---

## Итоговая сводка

### Количество этапов: 7

1. **Подготовка инфраструктуры** (3-5 дней)
2. **Backend API** (5-7 дней)
3. **Сервисы и утилиты** (3-4 дня)
4. **Базовые компоненты Vue.js** (5-7 дней)
5. **Функциональные компоненты и логика** (7-10 дней)
6. **Стилизация и адаптивность** (4-5 дней)
7. **Тестирование и оптимизация** (5-7 дней)

### Общая длительность: 32-45 дней (6-8 недель)

### Критические этапы (блокируют дальнейшую разработку):
- Этап 1: Подготовка инфраструктуры
- Этап 2: Backend API
- Этап 4: Базовые компоненты Vue.js
- Этап 5: Функциональные компоненты и логика

### Этапы, которые можно выполнять параллельно:
- Этап 3 (Сервисы) можно начинать параллельно с Этапом 2
- Этап 6 (Стилизация) можно начинать параллельно с Этапом 5 (частично)

---

## Рекомендации по планированию

### Для одного разработчика:
- Последовательное выполнение этапов
- Фокус на критических этапах
- Регулярное тестирование на каждом этапе

### Для команды разработчиков:
- Backend-разработчик: Этапы 1, 2, 7 (частично)
- Frontend-разработчик: Этапы 3, 4, 5, 6, 7 (частично)
- Параллельная работа на этапах 2-3 и 4-5

---

## История изменений

- **2025-12-12 11:00 (UTC+3, Брест):** Создан документ с этапами реализации

