# TASK-001: Подготовка инфраструктуры и окружения

**Дата создания:** 2025-12-12 11:05 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Критический  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Этап:** Этап 1 из 7  
**Длительность:** 3-5 дней

---

## Описание

Подготовка инфраструктуры и окружения для разработки интерфейса табеля присутствия на Vue.js. Создание структуры проекта, настройка сборщика, подготовка папок для данных и конфигурационных файлов.

**Связь с ТЗ:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md)  
**Связь с этапами:** [DOCS/TZ/implementation-stages.md](../TZ/implementation-stages.md) - Этап 1

---

## Контекст

Это первый этап разработки интерфейса табеля присутствия. Без выполнения этого этапа невозможно начать разработку остальных компонентов. Этап не имеет зависимостей от других задач и может быть выполнен сразу.

**Цель:** Создать готовую инфраструктуру для разработки Vue.js приложения внутри Bitrix24 placement.

---

## Модули и компоненты

### Структура проекта
- `js/vue-apps/timesheet/` — основная папка Vue.js приложения
- `js/vue-apps/timesheet/components/` — компоненты Vue.js
- `js/vue-apps/timesheet/services/` — сервисы для работы с API
- `js/vue-apps/timesheet/stores/` — состояние приложения (Vuex/Pinia)
- `js/vue-apps/timesheet/utils/` — утилиты

### Конфигурационные файлы
- `package.json` — зависимости npm
- `vite.config.js` или `webpack.config.js` — конфигурация сборщика
- `config/holidays-rb.json` — список белорусских праздников

### Папки для данных
- `data/` — папка для хранения JSON файлов табеля

### Backend (PHP)
- Не требуется на этом этапе

### Frontend (Vue.js)
- Базовая структура файлов (пустые файлы для будущих компонентов)

---

## Зависимости

- **От каких задач зависит:** Нет (это первая задача)
- **Какие задачи зависят от этой:**
  - TASK-002: Backend API (PHP endpoints)
  - TASK-003: Сервисы и утилиты (JavaScript)
  - TASK-004: Базовые компоненты Vue.js

---

## Ступенчатые подзадачи (5 подэтапов)

### Подэтап 1.1: Настройка структуры проекта для Vue.js
**Длительность:** 1 день

1. Создать папку `js/vue-apps/timesheet/`
2. Создать подпапки:
   - `components/` — для компонентов Vue.js
   - `services/` — для сервисов API
   - `stores/` — для состояния приложения
   - `utils/` — для утилит
3. Инициализировать npm проект: `npm init -y`
4. Создать базовый `package.json` с описанием проекта
5. Установить Vue.js 3.x: `npm install vue@3`
6. Проверить структуру папок

**Результат:** Готовая структура папок и установленный Vue.js

---

### Подэтап 1.2: Настройка сборщика (Vite)
**Длительность:** 1 день

1. Установить Vite и плагин Vue: `npm install -D vite @vitejs/plugin-vue`
2. Создать файл `vite.config.js` в корне проекта
3. Настроить конфигурацию Vite:
   - Подключить плагин Vue
   - Настроить точку входа: `js/vue-apps/timesheet/main.js`
   - Настроить выход: `dist/`
   - Настроить алиасы путей (опционально)
4. Создать файл `js/vue-apps/timesheet/main.js` (базовый)
5. Настроить dev-сервер:
   - Порт (например, 5173)
   - Автоматическое открытие браузера (опционально)
6. Настроить production-сборку:
   - Минификация
   - Оптимизация
   - Разделение на чанки (опционально)
7. Добавить скрипты в `package.json`:
   - `npm run dev` — запуск dev-сервера
   - `npm run build` — production-сборка
8. Протестировать сборку: запустить `npm run dev` и проверить работу

**Результат:** Настроенный сборщик Vite, работающий dev-сервер

---

### Подэтап 1.3: Создание структуры папок для данных
**Длительность:** 0.5 дня

1. Создать папку `data/` в корне проекта
2. Настроить права доступа:
   - Папка `data/`: `chmod 775 data/`
   - Проверить, что PHP может создавать подпапки и файлы
3. Создать тестовую структуру:
   - `data/12345/` — тестовая папка для пользователя
   - `data/12345/2025/` — тестовая папка для года
   - `data/12345/2025/12/` — тестовая папка для месяца
4. Проверить права на запись: создать тестовый файл `data/12345/2025/12/test.json`
5. Удалить тестовые файлы и папки
6. Добавить `data/` в `.gitignore` (если нужно)

**Результат:** Готовая папка `data/` с правильными правами доступа

---

### Подэтап 1.4: Создание конфигурационного файла праздников
**Длительность:** 1 день

1. Создать папку `config/` в корне проекта
2. Создать файл `config/holidays-rb.json`
3. Заполнить праздники для Республики Беларусь на 2025-2035 годы:
   - 1 января — Новый год
   - 7 января — Рождество Христово (православное)
   - 8 марта — День женщин
   - 1 мая — Праздник труда
   - 9 мая — День Победы
   - 3 июля — День Независимости Республики Беларусь
   - 7 ноября — День Октябрьской революции
   - 25 декабря — Рождество Христово (католическое)
4. Формат JSON:
```json
{
  "2025": [
    "2025-01-01",
    "2025-01-07",
    "2025-03-08",
    "2025-05-01",
    "2025-05-09",
    "2025-07-03",
    "2025-11-07",
    "2025-12-25"
  ],
  "2026": [...],
  ...
  "2035": [...]
}
```
5. Проверить валидность JSON файла
6. Учесть переносы рабочих дней (если известны на будущие годы)

**Результат:** Готовый файл `config/holidays-rb.json` с праздниками на 2025-2035 годы

---

### Подэтап 1.5: Настройка базовой структуры компонентов
**Длительность:** 0.5 дня

1. Создать пустые файлы компонентов в `js/vue-apps/timesheet/components/`:
   - `UserInfo.vue` — блок авторизации (ФИО, Должность)
   - `PeriodSelector.vue` — блок выбора месяца/года
   - `StatisticsBar.vue` — блок статистики
   - `CalendarGrid.vue` — календарная сетка
   - `CalendarCell.vue` — ячейка дня
   - `EditDayModal.vue` — модальное окно редактирования дня
   - `FillWeekButton.vue` — кнопка "Заполнить неделю"
   - `Preloader.vue` — прелоадер
2. Создать базовую структуру каждого компонента:
   - `<template>` с комментарием
   - `<script setup>` (Composition API)
   - `<style scoped>` (пустые стили)
3. Создать пустые файлы сервисов в `js/vue-apps/timesheet/services/`:
   - `Bitrix24ApiService.js`
   - `TimesheetApiService.js`
   - `HolidaysService.js`
4. Создать пустые файлы утилит в `js/vue-apps/timesheet/utils/`:
   - `dateHelpers.js`
   - `validation.js`
   - `constants.js`
5. Создать файл Store в `js/vue-apps/timesheet/stores/`:
   - `timesheetStore.js` (базовая структура)
6. Создать корневой компонент `TimesheetCalendar.vue`
7. Обновить `main.js` для подключения корневого компонента
8. Проверить, что все файлы созданы и структура корректна

**Результат:** Готовая структура всех компонентов, сервисов и утилит

---

## API-методы Bitrix24

На этом этапе API методы Bitrix24 не используются. Они будут использоваться в следующих этапах.

---

## Технические требования

### Vue.js
- **Версия:** Vue.js 3.x (последняя стабильная)
- **Подход:** Composition API (`<script setup>`)
- **Сборщик:** Vite (рекомендуется) или Webpack
- **Стили:** Scoped styles в компонентах

### Node.js и npm
- **Версия Node.js:** 18.x или выше
- **Версия npm:** 9.x или выше

### Структура файлов
- Все компоненты в отдельных файлах `.vue`
- Сервисы в отдельных файлах `.js`
- Утилиты в отдельных файлах `.js`

### Права доступа
- Папки: `775` (rwxrwxr-x)
- Файлы: `664` (rw-rw-r--)

### Конфигурация
- `vite.config.js` должен быть в корне проекта
- `package.json` должен содержать все необходимые скрипты
- `.gitignore` должен исключать `node_modules/`, `dist/`, `data/`

---

## Критерии приёмки

### Подэтап 1.1
- [ ] Создана структура папок `js/vue-apps/timesheet/` с подпапками
- [ ] Инициализирован npm проект
- [ ] Установлен Vue.js 3.x
- [ ] `package.json` содержит описание проекта

### Подэтап 1.2
- [ ] Установлены Vite и плагин Vue
- [ ] Создан и настроен `vite.config.js`
- [ ] Создан базовый `main.js`
- [ ] Добавлены скрипты `dev` и `build` в `package.json`
- [ ] Dev-сервер запускается без ошибок (`npm run dev`)
- [ ] Production-сборка работает (`npm run build`)

### Подэтап 1.3
- [ ] Создана папка `data/` с правами 775
- [ ] PHP может создавать подпапки и файлы в `data/`
- [ ] Тестовая структура создана и удалена успешно
- [ ] `data/` добавлена в `.gitignore` (если требуется)

### Подэтап 1.4
- [ ] Создана папка `config/`
- [ ] Создан файл `config/holidays-rb.json`
- [ ] Файл содержит праздники на 2025-2035 годы
- [ ] JSON файл валиден (проверка через `jsonlint` или в браузере)
- [ ] Все белорусские праздники включены

### Подэтап 1.5
- [ ] Созданы все пустые файлы компонентов
- [ ] Созданы все пустые файлы сервисов
- [ ] Созданы все пустые файлы утилит
- [ ] Создан файл Store с базовой структурой
- [ ] Создан корневой компонент `TimesheetCalendar.vue`
- [ ] `main.js` подключен к корневому компоненту
- [ ] Структура проекта соответствует архитектуре из ТЗ

### Общие критерии
- [ ] Все файлы созданы и структура проекта готова
- [ ] Сборщик настроен и работает
- [ ] Окружение готово для разработки
- [ ] Документация обновлена (если требуется)

---

## Примеры кода

### package.json (базовый)
```json
{
  "name": "timesheet-calendar",
  "version": "0.1.0",
  "description": "Интерфейс табеля присутствия для Bitrix24",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.4.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "vite": "^5.0.0"
  }
}
```

### vite.config.js
```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'js/vue-apps/timesheet')
    }
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    rollupOptions: {
      input: {
        main: resolve(__dirname, 'js/vue-apps/timesheet/main.js')
      }
    }
  },
  server: {
    port: 5173,
    open: false
  }
});
```

### main.js (базовый)
```javascript
import { createApp } from 'vue';
import TimesheetCalendar from './TimesheetCalendar.vue';

const app = createApp(TimesheetCalendar);
app.mount('#vue-timesheet-app');
```

### TimesheetCalendar.vue (базовый)
```vue
<template>
  <div class="timesheet-calendar">
    <!-- Компоненты будут добавлены в следующих этапах -->
    <h1>Табель присутствия</h1>
  </div>
</template>

<script setup>
// Логика будет добавлена в следующих этапах
</script>

<style scoped>
.timesheet-calendar {
  padding: 20px;
}
</style>
```

### config/holidays-rb.json (пример)
```json
{
  "2025": [
    "2025-01-01",
    "2025-01-07",
    "2025-03-08",
    "2025-05-01",
    "2025-05-09",
    "2025-07-03",
    "2025-11-07",
    "2025-12-25"
  ]
}
```

---

## Тестирование

### Проверка структуры проекта
1. Проверить наличие всех папок:
   ```bash
   ls -la js/vue-apps/timesheet/
   ls -la js/vue-apps/timesheet/components/
   ls -la js/vue-apps/timesheet/services/
   ls -la js/vue-apps/timesheet/stores/
   ls -la js/vue-apps/timesheet/utils/
   ```

2. Проверить наличие конфигурационных файлов:
   ```bash
   ls -la package.json
   ls -la vite.config.js
   ls -la config/holidays-rb.json
   ```

### Проверка сборщика
1. Запустить dev-сервер:
   ```bash
   npm run dev
   ```
   - Должен запуститься без ошибок
   - Должен быть доступен на http://localhost:5173

2. Проверить production-сборку:
   ```bash
   npm run build
   ```
   - Должна создаться папка `dist/`
   - В папке должны быть собранные файлы

### Проверка прав доступа
1. Проверить права на папку `data/`:
   ```bash
   ls -ld data/
   ```
   - Должны быть права `775`

2. Проверить возможность создания файлов:
   ```bash
   touch data/test.txt
   rm data/test.txt
   ```
   - Должен создаться и удалиться файл без ошибок

### Проверка JSON файла праздников
1. Проверить валидность JSON:
   ```bash
   cat config/holidays-rb.json | python3 -m json.tool
   ```
   - Должен вывести валидный JSON без ошибок

2. Проверить наличие всех годов (2025-2035):
   - Открыть файл и проверить наличие всех годов

---

## История правок

- **2025-12-12 11:05 (UTC+3, Брест):** Создана задача TASK-001 на основе Этапа 1, разбита на 5 подэтапов

---

## Примечания

### Порядок выполнения подэтапов
Подэтапы можно выполнять последовательно. Подэтапы 1.3 и 1.4 можно выполнять параллельно, так как они не зависят друг от друга.

### Важные замечания
- Все файлы компонентов создаются пустыми на этом этапе — логика будет добавлена в следующих этапах
- Сборщик Vite рекомендуется, но можно использовать Webpack, если есть требования
- Права доступа на папку `data/` критически важны — без них не будет работать сохранение данных

### Следующие шаги
После завершения TASK-001 можно переходить к:
- TASK-002: Backend API (PHP endpoints)
- TASK-003: Сервисы и утилиты (JavaScript)

---

## Связь с документацией

- **Техническое задание:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md)
- **Этапы реализации:** [DOCS/TZ/implementation-stages.md](../TZ/implementation-stages.md)
- **Руководство по Vue.js:** [DOCS/GUIDES/vue-development.md](../GUIDES/vue-development.md)
- **Архитектура:** [DOCS/ARCHITECTURE/tech-stack.md](../ARCHITECTURE/tech-stack.md)

