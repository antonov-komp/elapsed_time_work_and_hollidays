# TASK-007-03: E2E тесты

**Дата создания:** 2025-12-12 12:24 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Высокий  
**Исполнитель:** QA Engineer / Bitrix24 Программист (Vue.js)  
**Родительская задача:** [TASK-007](TASK-007-testing-documentation.md)  
**Подэтап:** 7.3 из 6  
**Длительность:** 1.5 дня

---

## Описание

Настройка E2E тестового окружения и написание end-to-end тестов для основных сценариев использования приложения табеля присутствия на разных устройствах.

**Связь с ТЗ:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md) - раздел 11  
**Связь с этапами:** [DOCS/TZ/implementation-stages.md](../TZ/implementation-stages.md) - Этап 7, Подэтап 7.3

---

## Контекст

Это третий подэтап тестирования. E2E тесты необходимы для проверки работы всего приложения от начала до конца, включая взаимодействие пользователя с интерфейсом.

**Зависит от:**
- TASK-005-06: Интеграция всех компонентов — приложение должно быть полностью интегрировано

---

## Модули и компоненты

### Тестирование
- `tests/e2e/scenarios/` — тесты основных сценариев
- `tests/e2e/devices/` — тесты на разных устройствах
- `tests/e2e/critical/` — тесты критических путей

### Тестовое окружение
- Playwright (рекомендуется) или Cypress
- Браузеры: Chrome, Firefox, Safari, Edge

---

## Зависимости

- **От каких задач зависит:**
  - TASK-005-06: Интеграция всех компонентов
  - TASK-006: Стилизация и адаптивность
- **Какие задачи зависят от этой:**
  - TASK-007-04: Исправление ошибок — будет использовать результаты тестов

---

## Ступенчатые подзадачи

### Шаг 1: Настройка E2E тестового окружения
1. Установить Playwright или Cypress:
   - `npm install -D @playwright/test` или `npm install -D cypress`
2. Создать конфигурационный файл:
   - `playwright.config.js` или `cypress.config.js`
3. Настроить конфигурацию:
   - Браузеры для тестирования
   - Разрешения экрана для разных устройств
   - Базовый URL приложения
4. Добавить скрипты в `package.json`:
   - `test:e2e` — запуск E2E тестов
   - `test:e2e:ui` — запуск с UI (для Cypress)

### Шаг 2: Тесты основных сценариев использования
1. Создать тест загрузки табеля:
   - Открытие приложения
   - Проверка загрузки данных пользователя
   - Проверка загрузки данных табеля
   - Проверка отображения календаря
2. Создать тест редактирования дня:
   - Клик на ячейку дня
   - Открытие модального окна
   - Ввод часов
   - Сохранение
   - Проверка обновления данных
3. Создать тест заполнения недели:
   - Клик на кнопку "Заполнить неделю"
   - Подтверждение действия
   - Проверка заполнения дней
4. Создать тест изменения периода:
   - Выбор другого месяца
   - Выбор другого года
   - Проверка загрузки данных для нового периода
5. Создать тест сохранения данных:
   - Редактирование дня
   - Проверка автосохранения
   - Проверка индикатора сохранения

### Шаг 3: Тесты на разных устройствах
1. Создать тесты для Desktop (> 1024px):
   - Все основные сценарии
   - Проверка адаптивности
2. Создать тесты для Tablet (768px - 1024px):
   - Все основные сценарии
   - Проверка адаптивности
3. Создать тесты для Mobile (< 768px):
   - Все основные сценарии
   - Проверка адаптивности
   - Проверка touch-оптимизации

### Шаг 4: Тесты для критических путей
1. Создать тест полного цикла работы с табелем:
   - Загрузка приложения
   - Редактирование нескольких дней
   - Заполнение недели
   - Изменение периода
   - Проверка сохранения всех данных
2. Создать тест обработки ошибок:
   - Ошибка загрузки данных пользователя
   - Ошибка загрузки данных табеля
   - Ошибка сохранения данных
   - Проверка отображения ошибок
3. Создать тест автосохранения:
   - Редактирование дня
   - Проверка debounce
   - Проверка сохранения
   - Проверка retry при ошибках

---

## Технические требования

### Тестирование
- **Фреймворк:** Playwright (рекомендуется) или Cypress
- **Браузеры:** Chrome, Firefox, Safari, Edge

### Устройства
- Desktop: > 1024px
- Tablet: 768px - 1024px
- Mobile: < 768px

---

## Критерии приёмки

- [ ] Настроено E2E тестовое окружение:
  - [ ] Установлен Playwright или Cypress
  - [ ] Создан конфигурационный файл
  - [ ] Настроены браузеры и устройства
- [ ] Написаны тесты основных сценариев использования:
  - [ ] Загрузка табеля
  - [ ] Редактирование дня
  - [ ] Заполнение недели
  - [ ] Изменение периода
  - [ ] Сохранение данных
- [ ] Написаны тесты на разных устройствах:
  - [ ] Desktop
  - [ ] Tablet
  - [ ] Mobile
- [ ] Написаны тесты для критических путей:
  - [ ] Полный цикл работы с табелем
  - [ ] Обработка ошибок
  - [ ] Автосохранение
- [ ] Все тесты проходят

---

## Примеры кода

### Конфигурация Playwright
```javascript
// playwright.config.js
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
  ],
});
```

### Пример E2E теста
```javascript
// tests/e2e/scenarios/timesheet.spec.js
import { test, expect } from '@playwright/test';

test.describe('Табель присутствия', () => {
  test('загрузка табеля', async ({ page }) => {
    await page.goto('/');
    
    // Проверка загрузки данных пользователя
    await expect(page.locator('.user-info')).toBeVisible();
    
    // Проверка загрузки календаря
    await expect(page.locator('.calendar-grid')).toBeVisible();
    
    // Проверка отображения дней
    const cells = page.locator('.calendar-cell');
    await expect(cells.first()).toBeVisible();
  });
  
  test('редактирование дня', async ({ page }) => {
    await page.goto('/');
    
    // Клик на первую ячейку
    await page.locator('.calendar-cell').first().click();
    
    // Проверка открытия модального окна
    await expect(page.locator('.modal-content')).toBeVisible();
    
    // Ввод часов
    await page.fill('input[type="number"]', '8');
    
    // Сохранение
    await page.click('button:has-text("Сохранить")');
    
    // Проверка закрытия модального окна
    await expect(page.locator('.modal-content')).not.toBeVisible();
    
    // Проверка обновления данных
    await expect(page.locator('.calendar-cell').first()).toContainText('8ч');
  });
  
  test('заполнение недели', async ({ page }) => {
    await page.goto('/');
    
    // Клик на кнопку "Заполнить неделю"
    await page.click('button:has-text("Заполнить неделю")');
    
    // Подтверждение
    await page.click('button:has-text("OK")');
    
    // Проверка заполнения дней
    const cells = page.locator('.calendar-cell.filled');
    await expect(cells).toHaveCount(5); // 5 рабочих дней
  });
});
```

---

## Тестирование

### Запуск тестов
```bash
# Запуск всех E2E тестов
npm run test:e2e

# Запуск на конкретном браузере
npx playwright test --project=chromium

# Запуск с UI (для отладки)
npm run test:e2e:ui
```

---

## История правок

- **2025-12-12 12:24 (UTC+3, Брест):** Создана задача TASK-007-03

---

## Примечания

### Важные замечания
- E2E тесты должны покрывать основные сценарии использования
- Тесты должны работать на разных устройствах
- Тесты должны быть стабильными и воспроизводимыми

### Следующие шаги
После завершения этого подэтапа можно переходить к:
- TASK-007-04: Исправление ошибок — будет использовать результаты тестов

---

## Связь с документацией

- **Родительская задача:** [TASK-007](TASK-007-testing-documentation.md)
- **Техническое задание:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md) - раздел 11


