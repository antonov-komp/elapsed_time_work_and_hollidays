# TASK-004: Базовые компоненты Vue.js

**Дата создания:** 2025-12-12 11:47 (UTC+3, Брест)  
**Статус:** Завершена  
**Приоритет:** Критический  
**Исполнитель:** Bitrix24 Программист (Vue.js)  
**Этап:** Этап 4 из 7  
**Длительность:** 5-7 дней

---

## Описание

Создание базовых компонентов Vue.js для интерфейса табеля присутствия. Реализация компонентов отображения данных, календарной сетки и пользовательского интерфейса.

**Связь с ТЗ:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md) - разделы 1, 2, 3, 10.1  
**Связь с этапами:** [DOCS/TZ/implementation-stages.md](../TZ/implementation-stages.md) - Этап 4

---

## Контекст

Это четвёртый этап разработки интерфейса табеля присутствия. Базовые компоненты Vue.js необходимы для отображения интерфейса и работы с данными. Без них невозможно создать рабочий интерфейс приложения.

**Зависит от:**
- TASK-003: Сервисы и утилиты (JavaScript) — сервисы и утилиты должны быть готовы
- TASK-001-05: Настройка базовой структуры компонентов (файлы уже созданы)

**Цель:** Создать все базовые компоненты Vue.js для отображения интерфейса табеля присутствия.

---

## Модули и компоненты

### Frontend (Vue.js)
- `js/vue-apps/timesheet/components/Preloader.vue` — компонент прелоадера
- `js/vue-apps/timesheet/components/UserInfo.vue` — компонент информации о пользователе
- `js/vue-apps/timesheet/components/PeriodSelector.vue` — компонент выбора периода
- `js/vue-apps/timesheet/components/StatisticsBar.vue` — компонент статистики
- `js/vue-apps/timesheet/components/CalendarCell.vue` — компонент ячейки дня
- `js/vue-apps/timesheet/components/CalendarGrid.vue` — компонент календарной сетки
- `js/vue-apps/timesheet/TimesheetCalendar.vue` — корневой компонент

### Используемые сервисы и утилиты
- `Bitrix24ApiService` — для получения данных пользователя
- `TimesheetApiService` — для получения и сохранения данных табеля
- `HolidaysService` — для получения праздников
- `dateHelpers` — утилиты для работы с датами
- `constants` — константы приложения

---

## Зависимости

- **От каких задач зависит:**
  - TASK-003: Сервисы и утилиты (JavaScript)
    - TASK-003-01: Создание сервиса для работы с Bitrix24 API
    - TASK-003-02: Создание сервиса для работы с табелем
    - TASK-003-03: Создание сервиса для работы с праздниками
    - TASK-003-04: Создание утилит для работы с датами
    - TASK-003-06: Создание констант
  - TASK-001-05: Настройка базовой структуры компонентов
- **Какие задачи зависят от этой:**
  - TASK-005: Функциональные компоненты и логика — будет расширять эти компоненты

---

## Ступенчатые подзадачи (6 подэтапов)

### Подэтап 4.1: Компонент прелоадера
**Длительность:** 0.5 дня

1. Открыть файл `js/vue-apps/timesheet/components/Preloader.vue`
2. Создать компонент с индикатором загрузки
3. Реализовать overlay с блокировкой интерфейса
4. Добавить пропсы для управления видимостью
5. Добавить стили (spinner, overlay)
6. Экспортировать компонент

**Результат:** Рабочий компонент прелоадера с индикатором загрузки

---

### Подэтап 4.2: Компонент информации о пользователе
**Длительность:** 1 день

1. Открыть файл `js/vue-apps/timesheet/components/UserInfo.vue`
2. Создать компонент с отображением ФИО и Должности
3. Интегрировать `Bitrix24ApiService` для загрузки данных
4. Реализовать состояние загрузки и ошибок
5. Добавить стили для отображения
6. Обработать случаи отсутствия данных

**Результат:** Рабочий компонент с отображением информации о пользователе

---

### Подэтап 4.3: Компонент выбора периода
**Длительность:** 1 день

1. Открыть файл `js/vue-apps/timesheet/components/PeriodSelector.vue`
2. Создать компонент с выбором месяца (выпадающий список)
3. Создать компонент с выбором года (выпадающий список)
4. Реализовать обработку изменения периода (emit события)
5. Добавить валидацию (год: 2025-2035, месяц: 1-12)
6. Добавить стили для выпадающих списков

**Результат:** Рабочий компонент выбора месяца и года

---

### Подэтап 4.4: Компонент статистики
**Длительность:** 1 день

1. Открыть файл `js/vue-apps/timesheet/components/StatisticsBar.vue`
2. Создать компонент с отображением статистики
3. Реализовать расчёт статистики:
   - Сумма часов всего
   - Сумма рабочих дней (дни с часами > 0)
   - Сумма неполных дней (дни с часами < 8)
   - Сумма дней со статусами
4. Реализовать реактивное обновление при изменении данных
5. Добавить стили для отображения статистики

**Результат:** Рабочий компонент статистики с реактивным обновлением

---

### Подэтап 4.5: Компонент ячейки дня
**Длительность:** 1.5 дня

1. Открыть файл `js/vue-apps/timesheet/components/CalendarCell.vue`
2. Создать компонент для отображения дня месяца
3. Реализовать визуальное выделение:
   - Сегодняшний день
   - Выходные дни
   - Праздничные дни
4. Реализовать отображение часов или статуса
5. Реализовать обработку клика (emit события)
6. Добавить стили для разных типов дней
7. Интегрировать утилиты `dateHelpers` и `constants`

**Результат:** Рабочий компонент ячейки дня с визуальным выделением

---

### Подэтап 4.6: Компонент календарной сетки
**Длительность:** 1.5 дня

1. Открыть файл `js/vue-apps/timesheet/components/CalendarGrid.vue`
2. Создать компонент для отображения всех дней месяца в виде сетки
3. Реализовать генерацию массива дней месяца
4. Интегрировать `CalendarCell.vue` для каждого дня
5. Реализовать определение типа дня (рабочий, выходной, праздник)
6. Реализовать загрузку данных табеля через `TimesheetApiService`
7. Реализовать загрузку праздников через `HolidaysService`
8. Добавить стили для сетки (grid layout)
9. Обработать события от `CalendarCell.vue`

**Результат:** Рабочий компонент календарной сетки с интеграцией данных

---

## API-методы Bitrix24

### Используемые методы
- `user.current` — получение данных текущего пользователя
  - Используется в `UserInfo.vue` через `Bitrix24ApiService`

---

## Технические требования

### Vue.js
- **Версия:** Vue.js 3.x (Composition API)
- **Подход:** `<script setup>` синтаксис
- **Стили:** Scoped styles в компонентах

### Компоненты
- Все компоненты должны быть реактивными
- Использование props и emits для коммуникации
- Обработка состояний загрузки и ошибок

### Интеграция
- Использование сервисов из TASK-003
- Использование утилит из TASK-003
- Использование констант из TASK-003

---

## Критерии приёмки

### Подэтап 4.1
- [ ] Создан компонент `Preloader.vue`
- [ ] Компонент отображает индикатор загрузки
- [ ] Реализован overlay с блокировкой интерфейса
- [ ] Компонент управляется через пропсы

### Подэтап 4.2
- [ ] Создан компонент `UserInfo.vue`
- [ ] Компонент отображает ФИО и Должность
- [ ] Интегрирован `Bitrix24ApiService`
- [ ] Обработаны состояния загрузки и ошибок

### Подэтап 4.3
- [ ] Создан компонент `PeriodSelector.vue`
- [ ] Реализован выбор месяца (выпадающий список)
- [ ] Реализован выбор года (выпадающий список)
- [ ] Реализована обработка изменения периода

### Подэтап 4.4
- [ ] Создан компонент `StatisticsBar.vue`
- [ ] Реализован расчёт всех показателей статистики
- [ ] Реализовано реактивное обновление при изменении данных

### Подэтап 4.5
- [ ] Создан компонент `CalendarCell.vue`
- [ ] Реализовано визуальное выделение разных типов дней
- [ ] Реализовано отображение часов или статуса
- [ ] Реализована обработка клика

### Подэтап 4.6
- [ ] Создан компонент `CalendarGrid.vue`
- [ ] Реализована генерация сетки дней месяца
- [ ] Интегрирован `CalendarCell.vue`
- [ ] Реализована загрузка данных табеля и праздников
- [ ] Реализовано определение типа дня

### Общие критерии
- [ ] Все компоненты работают корректно
- [ ] Интеграция с сервисами и утилитами работает
- [ ] Стили применены корректно
- [ ] Код соответствует стандартам ESLint

---

## Примеры кода

### Preloader.vue (базовый)
```vue
<template>
  <div v-if="visible" class="preloader-overlay">
    <div class="preloader-spinner"></div>
  </div>
</template>

<script setup>
defineProps({
  visible: {
    type: Boolean,
    default: false
  }
});
</script>

<style scoped>
.preloader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.preloader-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
```

### UserInfo.vue (базовый)
```vue
<template>
  <div class="user-info">
    <div v-if="loading" class="loading">Загрузка...</div>
    <div v-else-if="error" class="error">{{ error }}</div>
    <div v-else class="user-data">
      <span class="name">{{ fullName }}</span>
      <span v-if="position" class="separator">|</span>
      <span v-if="position" class="position">{{ position }}</span>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { Bitrix24ApiService } from '../services/Bitrix24ApiService.js';

const loading = ref(true);
const error = ref(null);
const fullName = ref('');
const position = ref('');

onMounted(async () => {
  try {
    loading.value = true;
    const user = await Bitrix24ApiService.getCurrentUser();
    
    const nameParts = [
      user.LAST_NAME,
      user.NAME,
      user.SECOND_NAME
    ].filter(Boolean);
    
    fullName.value = nameParts.length > 0 
      ? nameParts.join(' ') 
      : `Пользователь #${user.ID}`;
    
    position.value = user.WORK_POSITION || '';
  } catch (e) {
    error.value = e.message;
  } finally {
    loading.value = false;
  }
});
</script>

<style scoped>
.user-info {
  padding: 15px;
  background-color: #f5f5f5;
  border-bottom: 1px solid #ddd;
}

.user-data {
  font-size: 16px;
  font-weight: bold;
}

.separator {
  margin: 0 10px;
  color: #999;
}
</style>
```

---

## Тестирование

### Тестирование компонентов
1. Проверить отображение каждого компонента
2. Проверить интеграцию с сервисами
3. Проверить реактивность данных
4. Проверить обработку ошибок

---

## История правок

- **2025-12-12 11:47 (UTC+3, Брест):** Создана задача TASK-004 на основе Этапа 4, разбита на 6 подэтапов
- **2025-12-12 (UTC+3, Брест):** Задача завершена. Реализованы все 6 подэтапов:
  - 4.1: Компонент Preloader.vue с индикатором загрузки
  - 4.2: Компонент UserInfo.vue с интеграцией Bitrix24ApiService
  - 4.3: Компонент PeriodSelector.vue с выбором месяца и года
  - 4.4: Компонент StatisticsBar.vue с расчётом статистики
  - 4.5: Компонент CalendarCell.vue с визуальным выделением дней
  - 4.6: Компонент CalendarGrid.vue с интеграцией данных табеля и праздников

---

## Примечания

### Порядок выполнения подэтапов
Подэтапы можно выполнять последовательно или частично параллельно:
- Подэтапы 4.1, 4.2, 4.3 можно выполнять параллельно (не зависят друг от друга)
- Подэтапы 4.4, 4.5, 4.6 зависят от предыдущих

### Важные замечания
- Все компоненты должны использовать Composition API
- Все компоненты должны быть реактивными
- Обработка ошибок обязательна для всех компонентов

### Следующие шаги
После завершения TASK-004 можно переходить к:
- TASK-005: Функциональные компоненты и логика — будет расширять эти компоненты

---

## Связь с документацией

- **Техническое задание:** [DOCS/TZ/interface-timesheet-calendar.md](../TZ/interface-timesheet-calendar.md) - разделы 1, 2, 3, 10.1
- **Этапы реализации:** [DOCS/TZ/implementation-stages.md](../TZ/implementation-stages.md) - Этап 4
- **Руководство по Vue.js:** [DOCS/GUIDES/vue-development.md](../GUIDES/vue-development.md)

